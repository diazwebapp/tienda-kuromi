---
import Layout from "../layouts/Layout.astro"
import { peluches } from "../data/juguetes"
import ProductCard1 from "../components/ProductCard1.astro"
import StyleGridContainer1 from "../components/StyleGridContainer1.astro"
import { createFullUrlWithSlug } from "../utils/slugCreator"
import WithSidebar from "../layouts/WithSidebar.astro"
const title = "Peluches de Kuromi"
const description = "Adéntrate en el adorable y travieso mundo de Kuromi con nuestra exclusiva selección de peluches"
const canonical = createFullUrlWithSlug("peluches-de-kuromi")

let alturas = peluches.map(p=>p.caracteristicas.altura)
alturas = [...new Set(alturas)].sort((a,b)=>a-b)

let colores = peluches.map(p=>p.caracteristicas.color)
colores = [...new Set(colores)]

const normales = peluches.filter(p=> p.caracteristicas.altura < 39)
const grandes = peluches.filter(p=> p.caracteristicas.altura >= 40 && p.caracteristicas.altura <= 59)
const gigantes = peluches.filter(p=> p.caracteristicas.altura >= 60)

const mochilaUrl = createFullUrlWithSlug("mochilas-bolsos-de-kuromi")
---

<Layout title={title} description={description} canonical={canonical} >
    <WithSidebar>
        <aside>
            <button id="resetFilters" >resear filtros</button>
            <form class="filtro" >
                <fieldset>
                    <legend>Tamaños</legend>
                    {
                        alturas.map(t=><label><input type="radio" name="altura" value={t} /> {t} cm</label>)
                    }
                </fieldset>
                <fieldset>
                    <legend>Colores</legend>
                    {
                        colores.map(c=><label><input type="radio" name="color" value={c} /> {c} </label>)
                    }
                </fieldset>
            </form>
        </aside>
        <section>
            <h1>Peluches de Kuromi | Encuentra tu Compañero Ideal</h1>
            <p>
                Adéntrate en el adorable y travieso mundo de Kuromi con nuestra exclusiva selección de peluches. <br/>
                Encuentra el tamaño perfecto para tu colección al meojr estilo kawai, aquí encontrarás el peluche de Kuromi que estabas buscando.
            </p>
            <div class="rsfilter">
                <div class="toolbar"></div>
                <div class="gridFilter"></div>
            </div>
            <StyleGridContainer1 widthCard="200px" >
                {
                    normales.map((p)=>(
                        <ProductCard1 
                        nombre={p.nombre} 
                        imagen={p.imagen} 
                        precio={p.precio} 
                        caracteristicas={p.caracteristicas} 
                        rating={p.rating}
                        ratingCount={p.ratingCount}
                        refLink={p.refLink}
                        tienda={p.tienda}
                        />
                    ))
                }
            </StyleGridContainer1>
        </section>
        <section>
            <h2>¿Un kuromi de peluche grande es Perfecto para Ti?</h2>
            <p>
                Si tu corazón anhela un compañero de tamaño impresionante, no busques más. Hemos reunido una colección especial de los Peluches de Kuromi más grandes para aquellos que desean una presencia inigualable. <br/>Para tener en casa o hacer un regalo, no solo es un juguete, es tu compañero ideal. Y si deseas tambien tenemos ese <a href={mochilaUrl} style="color:var(--secondary-color);" >bolso de peluche</a> especial.
            </p>
            <StyleGridContainer1>
                {
                    grandes.map((p)=>(
                        <ProductCard1 
                        nombre={p.nombre} 
                        imagen={p.imagen} 
                        precio={p.precio} 
                        caracteristicas={p.caracteristicas} 
                        rating={p.rating}
                        ratingCount={p.ratingCount}
                        refLink={p.refLink}
                        tienda={p.tienda}
                        />
                    ))
                }
            </StyleGridContainer1>
        </section>
        <section>
            <h2>¿Buscas un abrazo enorme? ¡un kuromi peluche gigante te lo dará!</h2>
            <p>
                Están diseñado para ofrecer la máxima ternura y un impacto visual que transformará cualquier espacio. Encuentra ese peluche Kuromi de tamaño extra grande que convertirá cada momento en un abrazo con amor gigante.
            </p>
            <StyleGridContainer1>
                {
                    gigantes.map((p)=>(
                        <ProductCard1 
                        nombre={p.nombre} 
                        imagen={p.imagen} 
                        precio={p.precio} 
                        caracteristicas={p.caracteristicas} 
                        rating={p.rating}
                        ratingCount={p.ratingCount}
                        refLink={p.refLink}
                        tienda={p.tienda}
                        />
                    ))
                }
            </StyleGridContainer1>
        </section>
    </WithSidebar>
</Layout>

<style>
    
    /** estilos del filtro */
    .filtro{
        padding: 8px 0;
    }
    .filtro fieldset, .filtro fieldset legend{
            background-color: var(--secondary-color);
        }
    .filtro fieldset legend{
        padding: 3px 10px;
        border-radius: 7px 7px 0 0;
    }
    .filtro fieldset{
        border-radius: 7px;
        margin-bottom: 10px;
        padding: 10px;
        border:none;
    }
    .filtro fieldset label{
        display: block;
        border-bottom: 1px solid var(--shadow-color);
        padding: 10px 0;
        cursor: pointer;
    }
    @media (min-width: 916px) {
        
        
        aside{
            grid-row-start: 1;
            grid-row-end: 8; 
        }
        section{
            grid-column-start: 2;
            grid-column-end: 3;
        }
    }
</style>

<script>
    const products:any[] = []
    const resetFilters = document.querySelector<HTMLButtonElement>('#resetFilters')
    const tamanos = document.querySelectorAll<HTMLInputElement>('input[name="altura"]')
    const colores = document.querySelectorAll<HTMLInputElement>('input[name="color"]')
    const articles = document.querySelectorAll<HTMLElement>('article.product-card')


    if(tamanos.length > 0){
        tamanos.forEach(t=>{
            t.addEventListener('change',()=>{
                const product = buscarProductos(t.value)
                const exists = products.includes(product)
                if(!exists){
                    products.push(product)
                }
                console.log(products)
            })
        })
    }
    if(colores.length > 0){
        colores.forEach(c=>{
            c.addEventListener('change',()=>{
                const product = buscarProductos(null,c.value)
                const exists = products.includes(product)
                if(!exists){
                    products.push(product)
                }
                console.log(products)
            })
        })
    }
    if(resetFilters){
        resetFilters.addEventListener('click',()=>{
            resetearFiltros()
        })
    }
    
    function buscarProductos(dimenciones?:string | null,colores?:string){
        for(let article of articles){
            const altura = article.querySelector("small.dimenciones")
            const color = article.querySelector("small.colores")
            if(altura || color){
                const a = altura?.textContent
                const c = color?.textContent
                if(a && dimenciones){
                    if(a.includes(dimenciones)){
                        return article
                    }
                }
                if(c && colores){
                    if(c.includes(colores)){
                        return article
                    }
                }
            }
        }
    }

    function resetearFiltros(){
        products.length = 0

    }
        
</script>